{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "timeline-control",
  "dependencies": [
    "@base-ui/react"
  ],
  "registryDependencies": [
    "https://limeplay.winoffrg.dev/r/media-provider.json",
    "https://limeplay.winoffrg.dev/r/utils.json",
    "https://limeplay.winoffrg.dev/r/use-timeline.json",
    "https://limeplay.winoffrg.dev/r/use-track-events.json",
    "https://limeplay.winoffrg.dev/r/use-player.json"
  ],
  "files": [
    {
      "path": "registry/default/ui/timeline-control.tsx",
      "content": "\"use client\"\n\nimport { Slider as SliderPrimitive } from \"@base-ui/react/slider\"\nimport React, { useImperativeHandle, useRef } from \"react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { MediaReadyState } from \"@/registry/default/hooks/use-player\"\nimport { useTimeline } from \"@/registry/default/hooks/use-timeline\"\nimport { useTrackEvents } from \"@/registry/default/hooks/use-track-events\"\nimport { useMediaStore } from \"@/registry/default/ui/media-provider\"\n\nexport type TimelineRootPropsDocs = Pick<\n  React.ComponentProps<typeof SliderPrimitive.Root>,\n  \"disabled\" | \"orientation\"\n>\n\nexport const Root = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof SliderPrimitive.Root>\n>((props, ref) => {\n  const internalRef = useRef<HTMLDivElement>(\n    null\n  ) as React.RefObject<HTMLDivElement>\n  const { className, orientation = \"horizontal\", ...etc } = props\n\n  const player = useMediaStore((s) => s.player)\n  const currentTime = useMediaStore((s) => s.currentTime)\n  const duration = useMediaStore((s) => s.duration)\n  const isLive = useMediaStore((s) => s.isLive)\n  const currentValue = duration ? (currentTime / duration) * 100 : 0\n  const readyState = useMediaStore((s) => s.readyState)\n\n  const disabled = props.disabled || readyState < MediaReadyState.HAVE_METADATA\n\n  useImperativeHandle(ref, () => internalRef.current)\n  const { getTimeFromEvent, seek, setHoveringTime, setIsHovering } =\n    useTimeline()\n\n  const trackEvents = useTrackEvents({\n    onPointerDown: (progress, event) => {\n      if (player) {\n        const newTime = getTimeFromEvent(event)\n        const seekRange = player.seekRange()\n\n        const liveSeekTime = isLive\n          ? seekRange.start +\n            (newTime / duration) * (seekRange.end - seekRange.start)\n          : newTime\n\n        if (duration) {\n          seek(liveSeekTime)\n        }\n      }\n    },\n    onPointerMove: (progress, isPointerDown, event) => {\n      if (duration && player) {\n        const newTime = getTimeFromEvent(event)\n        const seekRange = player.seekRange()\n\n        setHoveringTime(newTime)\n        setIsHovering(true)\n\n        const liveSeekTime = isLive ? seekRange.start + newTime : newTime\n\n        if (isPointerDown) {\n          seek(liveSeekTime)\n        }\n      }\n    },\n    onPointerUp: () => {\n      setIsHovering(false)\n    },\n    orientation,\n  })\n\n  return (\n    <SliderPrimitive.Root\n      aria-label=\"Timeline Slider\"\n      className={cn(\n        `\n          relative h-1 rounded-full transition-[height] duration-150 ease-out-quad\n          data-[orientation=horizontal]:h-(--lp-timeline-track-height)\n          active:data-[orientation=horizontal]:h-(--lp-timeline-track-height-active)\n        `,\n        className\n      )}\n      orientation={orientation}\n      ref={internalRef}\n      value={[currentValue]}\n      {...trackEvents}\n      {...etc}\n      disabled={disabled}\n    />\n  )\n})\n\nRoot.displayName = \"SliderRoot\"\n\nexport const Track = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof SliderPrimitive.Track>\n>((props, ref) => {\n  const { className, ...etc } = props\n\n  return (\n    <SliderPrimitive.Track\n      className={cn(\n        `\n          relative flex h-full grow flex-row rounded-full bg-foreground/20\n          focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary/50\n        `,\n        className\n      )}\n      ref={ref}\n      tabIndex={0}\n      {...etc}\n    />\n  )\n})\n\nTrack.displayName = \"SliderTrack\"\n\nexport const Progress = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof SliderPrimitive.Track>\n>((props, ref) => {\n  const { className, ...etc } = props\n\n  const progress = useMediaStore((s) => s.progress)\n\n  return (\n    <SliderPrimitive.Indicator\n      className={cn(\n        \"h-full w-(--lp-played-width)! rounded-s-full bg-primary\",\n        className\n      )}\n      ref={ref}\n      style={\n        {\n          \"--lp-played-width\": `${progress * 100}%`,\n        } as React.CSSProperties\n      }\n      {...etc}\n    />\n  )\n})\n\nProgress.displayName = \"SliderProgress\"\n\nexport type TimelineBufferedPropsDocs = Pick<BufferedProps, \"variant\">\n\nexport type TimelineThumbPropsDocs = Pick<\n  ThumbProps,\n  \"position\" | \"showWithHover\"\n>\n\ninterface BufferedProps\n  extends React.ComponentProps<typeof SliderPrimitive.Track> {\n  /**\n   * How to render buffered ranges\n   * - \"default\": Show each buffered range separately\n   * - \"combined\": Merge all ranges into one\n   * - \"from-zero\": Show ranges from start to their end\n   * @default \"default\"\n   */\n  variant?: \"combined\" | \"default\" | \"from-zero\"\n}\n\ninterface ThumbProps\n  extends React.ComponentProps<typeof SliderPrimitive.Thumb> {\n  /**\n   * Custom position of the thumb in percentage\n   */\n  position?: number\n  /**\n   * Thumb moves with the cursor seeking over the timeline\n   */\n  showWithHover?: boolean\n}\n\nexport const Buffered = React.forwardRef<HTMLDivElement, BufferedProps>(\n  (props, ref) => {\n    const { className, variant = \"default\", ...etc } = props\n\n    const buffered = useMediaStore((s) => s.buffered)\n    const duration = useMediaStore((s) => s.duration)\n    const { processBufferedRanges } = useTimeline()\n\n    if (!duration || !buffered.length) {\n      return null\n    }\n\n    const normalizedPercentages = processBufferedRanges(buffered, variant)\n\n    return (\n      <div className={cn(\"absolute size-full\", className)} ref={ref} {...etc}>\n        {normalizedPercentages.map(({ startPercent, widthPercent }, index) => (\n          <SliderPrimitive.Indicator\n            className={cn(\n              `left-(--lp-buffered-start)! h-full w-(--lp-buffered-width)! bg-foreground/30`,\n              variant === \"from-zero\" && \"rounded-e-full\",\n              className\n            )}\n            key={`${index}_${startPercent}`}\n            style={\n              {\n                \"--lp-buffered-start\": `${startPercent}%`,\n                \"--lp-buffered-width\": `${widthPercent}%`,\n              } as React.CSSProperties\n            }\n          />\n        ))}\n      </div>\n    )\n  }\n)\n\nBuffered.displayName = \"SliderBuffered\"\n\nexport const Thumb = React.forwardRef<HTMLDivElement, ThumbProps>(\n  (props, ref) => {\n    const { className, position, showWithHover = false, ...etc } = props\n    const hoveringTime = useMediaStore((s) => s.hoveringTime)\n    const duration = useMediaStore((s) => s.duration)\n    const currentTime = useMediaStore((s) => s.currentTime)\n\n    let finalPosition = 0\n\n    if (!duration) {\n      return null\n    }\n\n    if (position && Number.isFinite(position)) {\n      finalPosition = position\n    } else if (showWithHover) {\n      finalPosition = (hoveringTime / duration) * 100\n    } else {\n      finalPosition = (currentTime / duration) * 100\n    }\n\n    return (\n      <SliderPrimitive.Thumb\n        className={cn(\n          `\n            left-(--lp-timeline-thumb-position)! size-4 rounded-full bg-primary\n            data-disabled:bg-primary/85\n          `,\n          className\n        )}\n        ref={ref}\n        {...etc}\n        style={\n          {\n            \"--lp-timeline-thumb-position\": `${finalPosition}%`,\n          } as React.CSSProperties\n        }\n      />\n    )\n  }\n)\n\nThumb.displayName = \"SliderThumb\"\n",
      "type": "registry:ui",
      "target": "components/limeplay/timeline-control.tsx"
    }
  ],
  "cssVars": {
    "theme": {
      "lp-timeline-track-height": "4px",
      "lp-timeline-track-height-active": "7px"
    },
    "light": {
      "lp-timeline-buffered-color": "oklch(0.985 0 0 / 0.4)"
    },
    "dark": {
      "lp-timeline-buffered-color": "oklch(0.985 0 0 / 0.4)"
    }
  },
  "type": "registry:ui"
}